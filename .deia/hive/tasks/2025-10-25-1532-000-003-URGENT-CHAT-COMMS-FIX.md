# URGENT TASK: BOT-003 - Chat Communications Fix
**From:** Q33N (BEE-000)
**To:** BOT-003
**Date:** 2025-10-25 15:32 CDT (EXECUTE IMMEDIATELY WHEN UNBLOCKED)
**Priority:** P0 CRITICAL - BLOCKING FEATURE
**Status:** QUEUED - Execute as FIRST priority when you respond/unblock
**Duration:** 15 minutes max

---

## MISSION CRITICAL

Port 8000 chat comms works 95%, needs 3 small JS fixes to be FULLY FUNCTIONAL. This is the path to replace CLI entirely.

---

## The Exact Fixes (Copy-Paste Ready)

### Fix 1: Initialize WebSocket (Line ~441)

**Current:**
```javascript
let ws = null;
// WebSocket created but never connected
```

**Change to:**
```javascript
let ws = null;

async function initWebSocket() {
    try {
        ws = new WebSocket(`ws://${window.location.host}/ws`);
        ws.onopen = () => {
            console.log('WebSocket connected');
            addMessage('assistant', '✓ Real-time messaging connected');
        };
        ws.onmessage = (event) => {
            const msg = JSON.parse(event.data);
            addMessage('assistant', msg.response || msg.content);
            hideTypingIndicator();
        };
        ws.onerror = (error) => {
            console.error('WebSocket error:', error);
            addMessage('assistant', 'Connection error - using fallback');
        };
        ws.onclose = () => {
            console.log('WebSocket disconnected');
        };
    } catch (error) {
        console.error('Failed to connect WebSocket:', error);
    }
}
```

**Where to put it:** Right after the `let ws = null;` line, before `refreshBotList()`

---

### Fix 2: Start Status Updates (Line ~428)

**Current:**
```javascript
let statusUpdateInterval = null;  // Created but never started
```

**Change to:**
```javascript
let statusUpdateInterval = null;

async function startStatusUpdates() {
    if (statusUpdateInterval) return;

    statusUpdateInterval = setInterval(async () => {
        try {
            const response = await fetch('/api/bots');
            const data = await response.json();

            statusList.innerHTML = '';
            for (const [botId, botData] of Object.entries(data.bots || {})) {
                const statusDiv = document.createElement('div');
                statusDiv.className = `status-item ${botData.status}`;
                statusDiv.innerHTML = `
                    <div class="status-label">${botId}</div>
                    <div class="status-value">Status: ${botData.status}</div>
                    <div class="status-value">PID: ${botData.pid || 'N/A'}</div>
                    <div class="status-value">Port: ${botData.port || 'N/A'}</div>
                `;
                statusList.appendChild(statusDiv);
            }
        } catch (error) {
            console.error('Status update error:', error);
        }
    }, 3000);  // Update every 3 seconds
}
```

**Where to put it:** Right after the status interval definition

---

### Fix 3: Call Initialization (Line ~500, in launchBot or after DOM loads)

**Add after `refreshBotList()` is called:**

```javascript
// Initialize when page loads
window.addEventListener('load', () => {
    refreshBotList();
    initWebSocket();
    startStatusUpdates();
});

// Restart WebSocket if it disconnects
window.addEventListener('beforeunload', () => {
    if (ws) ws.close();
});
```

**Where:** At the END of the JavaScript section, just before closing `</script>`

---

## Testing Flow

1. Start server: `python app.py` in llama-chatbot/
2. Open http://localhost:8000
3. Click "Launch Bot" → Enter "BOT-TEST-001"
4. Click "Select" button for the bot
5. Type command in input box → Click "Send"
6. Verify:
   - Response appears in chat
   - Status panel shows bot info
   - WebSocket connected (check browser console)
   - No errors in console

---

## Success Criteria

- [ ] WebSocket initializes on page load
- [ ] Status updates start automatically
- [ ] Bot selection enables input
- [ ] Commands send to correct bot
- [ ] Responses display in real-time
- [ ] Status dashboard shows live bot info
- [ ] No JavaScript errors in console
- [ ] Chat history loads when bot selected

---

## Why This Works

**Current state:** Code is 95% done, just needs initialization

**What was missing:**
- WebSocket connection never started
- Status polling never started
- No initialization on page load

**What these fixes do:**
- Connect WebSocket on page load
- Start status updates automatically
- Enable real-time message streaming
- Show live bot status

---

## Time Estimate

- Reading code: 2 min
- Making 3 changes: 10 min
- Testing: 3 min
- **Total: 15 minutes max**

---

## Impact

This unblocks:
- Real-time chat with bots (replaces CLI for basic commands)
- Live status monitoring
- Multi-bot control from single interface

---

**BOT-003: This is the FAST PATH to working chat comms. 15 minutes. Execute IMMEDIATELY when unblocked.**

If you're currently blocked on Deep Analytics, do this FIRST, then analytics.

---

**Q33N (BEE-000)**
